# DaSE-ML2025-Assignment5 è¯´æ˜

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°â€œNeedle in a Haystackâ€é•¿æ–‡æœ¬æ£€ç´¢è¯„æµ‹æ¡†æ¶ã€‚ç³»ç»Ÿä¼šæŠŠè‹¥å¹²å…³é”®ä¿¡æ¯ï¼ˆneedleï¼‰éšæœºæ’å…¥å¤šç¯‡æ–‡ç« ï¼ˆhaystackï¼‰ä¸­ï¼Œå¹¶è°ƒç”¨ä½ å®ç°çš„ Agent æ¥å›ç­”ç›¸å…³é—®é¢˜ï¼Œæœ€åä½¿ç”¨è¯„æµ‹å™¨æ‰“åˆ†ã€‚ä½ å¯ä»¥ç”¨è¯¥æ¡†æ¶æœ¬åœ°è°ƒè¯•ã€æäº¤å¹¶æŸ¥çœ‹æ’è¡Œæ¦œæˆç»©ã€‚

## ğŸš€ æ ¸å¿ƒæ£€ç´¢ç­–ç•¥ (Advanced Retrieval Strategy)

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäº **AdvancedRetrievalAgent** çš„é«˜ç²¾åº¦å¤šæ–‡æ¡£æ£€ç´¢ç³»ç»Ÿï¼Œä¸“é—¨é’ˆå¯¹é•¿æ–‡æœ¬ä¸­çš„â€œå¤§æµ·æé’ˆâ€åœºæ™¯è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ã€‚

### 1. å…¨é‡åˆ†å—ä¸ç²—ç­› (Chunking & Hybrid Filtering)
*   **æ»‘åŠ¨çª—å£åˆ†å—**ï¼šå°†æ‰€æœ‰æ–‡æ¡£åˆ‡åˆ†ä¸ºçº¦ 1200 å­—ç¬¦çš„å—ï¼ˆå¸¦ 300 å­—ç¬¦é‡å ï¼‰ï¼Œç¡®ä¿æ²¡æœ‰ä»»ä½•ä¿¡æ¯é—æ¼ï¼ŒåŒæ—¶ä¿è¯è¯­ä¹‰ç‰‡æ®µçš„å®Œæ•´æ€§ã€‚
*   **å…³é”®è¯è¯„åˆ† (BM25 æ€æƒ³)**ï¼šé’ˆå¯¹é—®é¢˜ä¸­çš„ç¼–ç ã€æ•°å­—ã€æ—¥æœŸç­‰ç¡¬ä¿¡æ¯è¿›è¡Œå…³é”®è¯åŒ¹é…è¯„åˆ†ã€‚
*   **æ‰¹é‡å‘é‡åŒ– (Batch Embedding)**ï¼šåˆ©ç”¨ `ecnu-embedding-small` æ¨¡å‹ï¼Œå¯¹å…³é”®è¯å¾—åˆ†æœ€é«˜çš„å‰ 200 ä¸ªå—è¿›è¡Œæ‰¹é‡å‘é‡åŒ–å¤„ç†ã€‚
*   **æ··åˆè¯„åˆ† (Hybrid Score)**ï¼šç»¼åˆå‘é‡ç›¸ä¼¼åº¦ (70%) ä¸å…³é”®è¯åŒ¹é… (30%)ï¼Œé€‰å‡ºå‰ 100 ä¸ªæœ€ç›¸å…³çš„å€™é€‰ç‰‡æ®µã€‚

### 2. å¤§è§„æ¨¡é‡æ’åº (Large-scale Reranking)
*   **ç²¾æ’æŠŠå…³**ï¼šä½¿ç”¨ `ecnu-rerank` æ¨¡å‹å¯¹ 100 ä¸ªå€™é€‰ç‰‡æ®µè¿›è¡Œå…¨é‡é‡æ’åºã€‚è¯¥æ¨¡å‹åœ¨ 8K ä¸Šä¸‹æ–‡å†…å…·æœ‰æé«˜çš„åŒºåˆ†åº¦ï¼Œèƒ½æœ‰æ•ˆå°†â€œé’ˆâ€ä»å¹²æ‰°é¡¹ä¸­å‰¥ç¦»ã€‚
*   **é«˜å¯†åº¦ä¸Šä¸‹æ–‡**ï¼šæœ€ç»ˆé€‰å–é‡æ’å¾—åˆ†æœ€é«˜çš„ **30 ä¸ªç‰‡æ®µ**ï¼ˆçº¦ 10k-15k tokensï¼‰ä½œä¸º LLM çš„è¾“å…¥ä¸Šä¸‹æ–‡ã€‚

### 3. é²æ£’çš„ LLM ç”Ÿæˆ
*   **JSON æ¨¡å¼å¼ºåˆ¶è¾“å‡º**ï¼šç¡®ä¿ Agent è¿”å›ç»“æ„åŒ–çš„ JSON ç»“æœï¼Œé¿å…æ€ç»´é“¾ï¼ˆThinking Processï¼‰æ³„éœ²åˆ°æœ€ç»ˆç­”æ¡ˆä¸­ã€‚
*   **æ€ç»´é“¾æ§åˆ¶**ï¼šé’ˆå¯¹æ”¯æŒæ€è€ƒçš„æ¨¡å‹ï¼ˆå¦‚ GLM-4.5ï¼‰ï¼Œæ˜¾å¼æ§åˆ¶ `thinking` æ¨¡å¼çš„å¼€å¯ä¸å…³é—­ï¼Œæå‡å“åº”é€Ÿåº¦å¹¶é˜²æ­¢æ ¼å¼æ±¡æŸ“ã€‚

---

## âš™ï¸ ç¯å¢ƒé…ç½® (.env)

è¯·ç¡®ä¿ä½ çš„ `.env` æ–‡ä»¶åŒ…å«ä»¥ä¸‹é…ç½®ã€‚**æ³¨æ„ï¼šæˆ‘ä»¬å¯¹ API è·å–é€»è¾‘è¿›è¡Œäº†é‡è¦æ”¹åŠ¨ã€‚**

### 1. åŸºç¡€é…ç½®
```env
# --- åŸºç¡€é…ç½® ---
STUDENT_ID=å­¦å·
STUDENT_NAME=å§“å
STUDENT_NICKNAME=æ˜µç§°ï¼ˆæ’è¡Œæ¦œæ˜¾ç¤ºï¼‰
MAIN_CONTRIBUTOR=ai

# --- ä¸»æ¨¡å‹é…ç½® (ç”¨äº Agent ç”Ÿæˆç­”æ¡ˆ) ---
API_KEY=ä½ çš„APIå¯†é’¥
BASE_URL=https://api.example.com/v1
MODEL_NAME=glm-4.5-plus
ENABLE_THINK=false

# --- ECNU ä¸“ç”¨æ¨¡å‹é…ç½® (ç”¨äº Embedding å’Œ Rerankï¼Œå¿…é¡»é…ç½®) ---
ECNU_API_KEY=ä½ çš„ECNUå¯†é’¥
ECNU_BASE_URL=https://chat.ecnu.edu.cn/open/api/v1
```

### 2. è¯„æµ‹å™¨é…ç½® (LLMEvaluator)
**âš ï¸ é‡è¦æ”¹åŠ¨ï¼š** `LLMEvaluator` ç°åœ¨ä¼š**ç›´æ¥ä¸”ä¼˜å…ˆ**ä»ä»¥ä¸‹ç¯å¢ƒå˜é‡ä¸­è·å– API ä¿¡æ¯ï¼Œä»¥å®ç°è¯„æµ‹ç¯å¢ƒä¸ Agent ç¯å¢ƒçš„å®Œå…¨éš”ç¦»ï¼š

```env
# --- è¯„æµ‹æ¨¡å‹é…ç½® (å¯é€‰ï¼Œç‹¬ç«‹äº Agent) ---
EVAL_API_KEY=è¯„æµ‹å¯†é’¥
EVAL_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
EVAL_MODEL_NAME=glm-4.5
```

---

## ğŸ› ï¸ å¸¸ç”¨æŒ‡ä»¤

## ç›®å½•é€Ÿè§ˆä¸æ–‡ä»¶ä½œç”¨

- `run.py`ï¼šå‘½ä»¤è¡Œå…¥å£ï¼Œè¯»å–æµ‹è¯•ç”¨ä¾‹å¹¶è°ƒç”¨å¯¹åº”çš„æµ‹è¯•å™¨ä¸è¯„æµ‹å™¨ã€‚
- `llm_multi_needle_haystack_tester.py`ï¼šå¤šæ–‡æ¡£åœºæ™¯æµ‹è¯•å™¨ï¼Œå°†å¤šä¸ª needle æ’å…¥ä¸åŒæ–‡ä»¶å¹¶è¯„æµ‹ã€‚
- `llm_single_needle_haystack_tester.py`ï¼šå•æ–‡æ¡£åœºæ™¯æµ‹è¯•å™¨ï¼Œæ”¯æŒä¸åŒä¸Šä¸‹æ–‡é•¿åº¦ä¸æ’å…¥æ·±åº¦çš„ç»„åˆã€‚
- `model.py`ï¼š`ModelProvider` æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰ Agent å¿…é¡»å®ç°çš„æ¥å£ã€‚
- `agents/`ï¼šç¤ºä¾‹ä¸å‚è€ƒ Agentï¼Œ`agent_template.py`ï¼ˆå¼‚æ­¥ç¤ºä¾‹ï¼‰ï¼Œ`sync_agent.py`ï¼ˆé«˜çº§æ£€ç´¢ Agent å®ç°ï¼‰ã€‚
- `evaluators/`ï¼šè¯„æµ‹å™¨å®ç°ï¼Œ`string_match_evaluator` ä¸ºç²¾ç¡®åŒ¹é…ï¼Œ`llm_evaluator` ä½¿ç”¨å¤§æ¨¡å‹è¯„åˆ†ï¼ˆæ”¯æŒ JSON æ¨¡å¼ä¸æ€è€ƒæ¨¡å¼ç¦ç”¨ï¼‰ã€‚
- `test_case_loader.py`ï¼šè¯»å–ä¸æ ¡éªŒæµ‹è¯•ç”¨ä¾‹ JSONã€‚
- `test_cases/`ï¼šç¤ºä¾‹æˆ–è¯„æµ‹ç”¨çš„æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶å¤¹ã€‚
- `PaulGrahamEssays/`ï¼šé»˜è®¤çš„ haystack æ–‡æœ¬é›†åˆã€‚
- `submit.py` + `submit_core.*`ï¼šæäº¤è„šæœ¬ä¸æ ¸å¿ƒå®ç°ã€‚
- `Assignment5.md`ï¼šä½œä¸šåŸæ–‡è¯´æ˜ä¸è¯„åˆ†è§„åˆ™ã€‚
- `check_api.py`ï¼šå¿«é€ŸéªŒè¯ API è¿é€šæ€§çš„å°å·¥å…·ã€‚

## å·¥ä½œæµä¸è¿è¡Œæ–¹å¼

1. **ç¼–å†™ Agent**

   - ç»§æ‰¿ `model.ModelProvider` å¹¶å®ç°å››ä¸ªæ¥å£ï¼š
     - `evaluate_model`ï¼šæ¥æ”¶ prompt å­—å…¸ï¼ˆåŒ…å«ä¸Šä¸‹æ–‡ä¸é—®é¢˜ï¼‰ï¼Œè¿”å›å›ç­”å­—ç¬¦ä¸²ã€‚
     - `generate_prompt`ï¼šç»„è£…ä¼ ç»™ `evaluate_model` çš„å­—å…¸ç»“æ„ã€‚
     - `encode_text_to_tokens` / `decode_tokens`ï¼šç”¨äºè®¡ç®—ã€æˆªæ–­ä¸è¿˜åŸæ–‡æœ¬é•¿åº¦ã€‚
   - å¯å‚è€ƒ `agents/agent_template.py`ï¼ˆåŸºçº¿éšæœºç­–ç•¥ï¼‰æˆ– `agents/sync_agent.py`ï¼ˆåŒæ­¥ã€å¤šç­–ç•¥æ£€ç´¢ï¼‰è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚
   - `ModelProvider` æ˜¯çº¯æŠ½è±¡åŸºç±»ï¼Œå¿…é¡»åœ¨è‡ªå®šä¹‰ Agent ä¸­å®Œæ•´å®ç° `evaluate_model`ã€`generate_prompt`ã€`encode_text_to_tokens` ä»¥åŠ `decode_tokens` ç­‰æ¥å£ï¼Œå¦åˆ™æµ‹è¯•æµç¨‹ä¼šå›  `NotImplementedError` æˆ–ç±»å‹ä¸åŒ¹é…è€Œå¤±è´¥ã€‚`agents/agent_template.py` ä¸ `agents/sync_agent.py` å±•ç¤ºäº†å¯è¿è¡Œçš„å®ç°ã€‚
2. **å‡†å¤‡æµ‹è¯•ç”¨ä¾‹**

   - å°†è‡ªå®šä¹‰æµ‹è¯•é›†å†™å…¥ JSONï¼Œå­—æ®µè‡³å°‘åŒ…å« `needle`ã€`question`ã€`ground_truth`ï¼Œå¯é€‰ `id`ã€‚
   - é€šè¿‡ `test_case_loader.py` è‡ªåŠ¨åˆ¤æ–­å• needle æˆ–å¤š needleï¼ˆ`needle` ä¸ºåˆ—è¡¨ä¸”é•¿åº¦>1 æ—¶è§†ä¸ºå¤š needleï¼‰ã€‚
3. **æœ¬åœ°è¿è¡Œè¯„æµ‹**

   ```bash
   # Bash / macOS / Linux
   python run.py \
      --agent agents.sync_agent:AdvancedRetrievalAgent \
      --test_case_json test_cases/test_cases_all_en.json \
      --test_mode multi \
      --evaluator_type llm \
      --num_tests 1
   ```

   ```powershell
   # PowerShell (Windows)
   python run.py `
      --agent agents.sync_agent:AdvancedRetrievalAgent `
      --test_case_json test_cases/test_cases_all_en.json `
      --test_mode multi `
      --evaluator_type llm `
      --num_tests 1
   ```

   > ğŸ’¡ **æç¤º**ï¼šç¤ºä¾‹ä¸­é»˜è®¤ä½¿ç”¨ `--evaluator_type llm`ï¼Œå› ä¸ºè¿™æ˜¯æ­£å¼è¯„æµ‹çš„æ ‡å‡†ã€‚å¦‚æœä½ åœ¨å¼€å‘åˆæœŸéœ€è¦å¿«é€ŸéªŒè¯é€»è¾‘ã€èŠ‚çœ API æ¶ˆè€—ï¼Œå¯ä»¥ä½¿ç”¨ `--evaluator_type string` è¿›è¡Œç²¾ç¡®åŒ¹é…æµ‹è¯•ã€‚
   >

   - `--haystack_dir` å¯æŒ‡å®šå…¶ä»–æ–‡æœ¬ç›®å½•ã€‚
   - å•æ–‡æ¡£æ¨¡å¼å¯è°ƒèŠ‚ `context_lengths_*` ä¸ `document_depth_percent_*` æ§åˆ¶é•¿åº¦ä¸æ’å…¥ä½ç½®ã€‚

é€‰æ‹©å»ºè®®ï¼šè‹¥éœ€å¿«é€Ÿæ‰¹é‡éªŒè¯ç”¨ `--evaluator_type string`ï¼›è‹¥æƒ³è¯„ä¼°è¯­ä¹‰ç­‰ä»·æˆ–æ›´æ¥è¿‘äººå·¥åˆ¤æ–­å¯é€‰ `--evaluator_type llm`ã€‚ä¸è®ºä½¿ç”¨å“ªç§è¯„æµ‹å™¨ï¼Œæ•´ä¸ªæµ‹è¯•æµç¨‹éƒ½éœ€è¦è°ƒç”¨ APIï¼Œæ‰€ä»¥ `string` ä¹Ÿä¼šæœ‰ API æˆæœ¬ã€‚æ­£å¼éªŒè¯ä¸æ¯”èµ›æ’åºé˜¶æ®µåº”ä¼˜å…ˆèµ° `--evaluator_type llm`ã€‚

- è¿è¡Œç»“æŸåï¼Œè‹¥ `save_results=True`ï¼Œç»“æœå†™å…¥ `results/`ï¼Œä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰å†™å…¥ `contexts/`ã€‚

### å‚æ•°è¯´æ˜ï¼š`test_mode` ä¸ `evaluator_type`

- `test_mode`ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰

  - å¯é€‰ï¼š`multi` æˆ– `single`ã€‚
  - `multi`ï¼šå¤šæ–‡æ¡£/å¤š needle åœºæ™¯ï¼Œä½¿ç”¨ `LLMMultiNeedleHaystackTester`ã€‚é€‚åˆè¯„ä¼°æ¨¡å‹åœ¨ä¸åŒæ–‡æ¡£ä¸ä¸åŒæ’å…¥ä½ç½®ä¸Šçš„é²æ£’æ€§ï¼Œä¼šå¯¹æ¯ä¸ªç”¨ä¾‹è¿›è¡Œå¤šæ¬¡éšæœºè¯•éªŒï¼ˆå— `--num_tests` æ§åˆ¶ï¼‰ï¼Œä½† API è°ƒç”¨ä¸è¿è¡Œæ—¶é—´è¾ƒå¤šã€‚
  - `single`ï¼šå•æ–‡æ¡£/å• needle åœºæ™¯ï¼Œä½¿ç”¨ `LLMSingleNeedleHaystackTester`ã€‚é€‚åˆåšä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆ`context_lengths_*`ï¼‰å’Œæ’å…¥æ·±åº¦ï¼ˆ`document_depth_percent_*`ï¼‰çš„ç½‘æ ¼æ‰«æä¸å¯é‡å¤å®éªŒï¼Œä¾¿äºåˆ†ææ¨¡å‹å¯¹ä¸Šä¸‹æ–‡è§„æ¨¡çš„æ•æ„Ÿæ€§ã€‚
- `evaluator_type`ï¼ˆè¯„æµ‹å™¨ç±»å‹ï¼‰

  - å¯é€‰ï¼š`string` æˆ– `llm`ã€‚
  - `string`ï¼šä½¿ç”¨ `StringMatchEvaluator` è¿›è¡Œç²¾ç¡®å­—ç¬¦ä¸²åŒ¹é…ï¼ˆå¯å¿½ç•¥å¤§å°å†™/ç©ºç™½ï¼‰ã€‚è™½ç„¶æ¯” `llm` æ¨¡å¼æ›´ç›´æ¥ï¼Œä½†è¯„æµ‹æœ¬è´¨ä»éœ€è°ƒç”¨ä¸€æ¬¡æ¨¡å‹ APIï¼Œä¸»è¦çœåœ¨è¯„åˆ†é€»è¾‘å¤æ‚åº¦ä¸ç¬¬äºŒæ¬¡è°ƒç”¨ä¸Šã€‚é€‚åˆ exact-match åœºæ™¯ä¸æœ¬åœ°è°ƒè¯•ã€‚
  - `llm`ï¼šä½¿ç”¨ `LLMEvaluator` é€šè¿‡å¦ä¸€ä¸ªå¤§æ¨¡å‹å¯¹è¾“å‡ºä¸ ground truth åšè¯­ä¹‰è¯„åˆ†ã€‚èƒ½è¯†åˆ«åŒä¹‰æ”¹å†™ä¸éƒ¨åˆ†æ­£ç¡®ï¼Œé»˜è®¤ç”¨äºæ­£å¼è¯„æµ‹ï¼ˆä¸ `Assignment5.md` ä¸­çš„é»˜è®¤ä¸€è‡´ï¼‰ï¼Œä½†ä¼šå¢åŠ å»¶è¿Ÿä¸ API æˆæœ¬ï¼Œè¯„åˆ†å­˜åœ¨ä¸€å®šéšæœºæ€§ã€‚

é€‰æ‹©å»ºè®®ï¼šè‹¥éœ€å¿«é€Ÿæ‰¹é‡éªŒè¯ç”¨ `--evaluator_type string`ï¼›è‹¥æƒ³è¯„ä¼°è¯­ä¹‰ç­‰ä»·æˆ–æ›´æ¥è¿‘äººå·¥åˆ¤æ–­å¯é€‰ `--evaluator_type llm`ã€‚è‹¥è¯„ä¼°å¤šæ–‡æ¡£æ£€ç´¢ç¨³å¥æ€§é€‰ `--test_mode multi`ï¼Œåšå¯æ§å˜é‡æ‰«ææ—¶é€‰ `--test_mode single`ã€‚

## é«˜çº§æ£€ç´¢ Agent ç‰¹æ€§ (`AdvancedRetrievalAgent`)

æœ¬é¡¹ç›®é»˜è®¤æ¨èä½¿ç”¨ `AdvancedRetrievalAgent`ï¼Œå®ƒå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

1. **ä¸¤é˜¶æ®µæ£€ç´¢æ¶æ„**ï¼š
   - **ç²—æ’**ï¼šåŸºäºå¢å¼ºå…³é”®è¯æå–ï¼ˆæ”¯æŒç¼–ç ã€æ—¥æœŸã€æ•°å­—ï¼‰è¿›è¡Œæ–‡ä»¶çº§è¿‡æ»¤ã€‚
   - **ç²¾æ’**ï¼šé›†æˆ `ecnu-rerank` æ¨¡å‹ï¼Œå¯¹å€™é€‰ç‰‡æ®µè¿›è¡Œè¯­ä¹‰é‡æ’åºï¼Œç¡®ä¿â€œé’ˆâ€è¢«ç²¾å‡†å®šä½ã€‚
2. **API éš”ç¦»ä¸å…œåº•**ï¼š
   - æ£€ç´¢é˜¶æ®µï¼ˆEmbedding/Rerankï¼‰å¼ºåˆ¶èµ° `ECNU_API_KEY`ï¼Œç¡®ä¿æ¥å£å¯ç”¨æ€§ã€‚
   - ç”Ÿæˆé˜¶æ®µæ”¯æŒ `API_KEY` -> `ECNU_API_KEY` è‡ªåŠ¨å…œåº•ã€‚
3. **æ€è€ƒæ¨¡å¼ç²¾å‡†æ§åˆ¶**ï¼š
   - é’ˆå¯¹ GLM-4.5 ç­‰æ¨¡å‹ï¼Œåœ¨å…³é—­æ€è€ƒæ¨¡å¼æ—¶æ˜¾å¼å‘é€ `thinking: disabled` æŒ‡ä»¤ï¼Œé˜²æ­¢â€œæ€è€ƒæ³„éœ²â€ã€‚
4. **ä¸Šä¸‹æ–‡ä¼˜åŒ–**ï¼š
   - å‡­å€Ÿ Rerank çš„é«˜ç²¾åº¦ï¼Œå°†ä¸Šä¸‹æ–‡çª—å£ä¼˜åŒ–è‡³ **16K**ï¼Œåœ¨ä¿è¯å‡†ç¡®ç‡çš„åŒæ—¶å¤§å¹…æå‡å“åº”é€Ÿåº¦ã€‚

## æäº¤ä½œä¸š

   ä½¿ç”¨ `submit.py` è„šæœ¬æäº¤ä½ çš„ Agent å®ç°ã€‚è¯·ç¡®ä¿æä¾›å®Œæ•´çš„æ¨¡å—è·¯å¾„ï¼š

   ```bash
   # ç¤ºä¾‹ï¼šæäº¤ agents ç›®å½•ä¸‹çš„ sync_agent.py ä¸­çš„ SyncRetrievalAgent ç±»
   python submit.py --agent agents.sync_agent:SyncRetrievalAgent
   ```

   æäº¤æˆåŠŸåï¼Œä½ çš„ Agent å°†åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œæ­£å¼è¯„æµ‹ã€‚

## æŸ¥çœ‹ä¸è°ƒè¯•

   - æ§åˆ¶å°ä¼šè¾“å‡ºæ¯ä¸ªç”¨ä¾‹çš„å¾—åˆ†ã€å‡å€¼ã€æœ€å¥½/æœ€å·®ç­‰ç»Ÿè®¡ã€‚
   - å¼€å¯ `--print_ongoing_status` å¯å®æ—¶æŸ¥çœ‹æ’å…¥ needleã€ç”Ÿæˆ prompt ä¸æ¨¡å‹å“åº”æ‘˜è¦ã€‚
5. **æäº¤è¯„æµ‹**

   ```bash
   python submit.py --agent your_module:YourAgentClass
   ```

   - ä¼˜å…ˆä»å‘½ä»¤è¡Œè¯»å– `--api_key` / `--base_url`ï¼Œå¦åˆ™å›é€€åˆ° `.env`ã€‚
   - æäº¤è„šæœ¬ä¼šæ ¡éªŒ `STUDENT_ID`ã€`STUDENT_NAME`ã€`STUDENT_NICKNAME`ã€`MAIN_CONTRIBUTOR` ç­‰ä¿¡æ¯ã€‚

## æ¨èå·¥ä½œæµï¼ˆå¼€å‘ â†’ è¯„æµ‹ â†’ æäº¤ï¼‰åŠç¤ºä¾‹å‘½ä»¤

ä¸‹é¢ç»™å‡ºä»æœ¬åœ°å¼€å‘åˆ°æœ€ç»ˆæäº¤çš„æ¨èæµç¨‹ä¸ç¤ºä¾‹å‘½ä»¤ï¼š

1) å¿«é€ŸéªŒè¯ API ä¸ç¯å¢ƒï¼ˆè½»é‡ï¼‰

```bash
python check_api.py
```

2) å°è§„æ¨¡éªŒè¯ / smoke testï¼ˆå¿«é€Ÿè¿­ä»£ï¼Œä½æˆæœ¬ï¼‰

```bash
# Bash / macOS / Linux
python run.py \
   --agent agents.sync_agent:SyncRetrievalAgent \
   --test_case_json test_cases/test_cases_all_en.json \
   --test_mode single \
   --evaluator_type llm \
   --num_tests 1
```

```powershell
# PowerShellï¼ˆWindowsï¼‰
python run.py `
   --agent agents.sync_agent:SyncRetrievalAgent `
   --test_case_json test_cases/test_cases_all_en.json `
   --test_mode single `
   --evaluator_type llm `
   --num_tests 1
```

> ğŸ’¡ **æç¤º**ï¼šæ­¤å¤„ä½¿ç”¨ `--evaluator_type llm` è¿›è¡Œè¯­ä¹‰è¯„æµ‹ã€‚åœ¨å¼€å‘åˆæœŸï¼Œè‹¥éœ€å¿«é€ŸéªŒè¯é€»è¾‘ï¼Œå¯ä¸´æ—¶åˆ‡æ¢ä¸º `string` æ¨¡å¼ã€‚

3) å®Œæ•´è¯„æµ‹å¹¶ä¿å­˜ç»“æœï¼ˆç”Ÿæˆ `results/`ï¼Œç”¨äºæäº¤ä¸ç»Ÿè®¡ï¼‰

```bash
# Bash / macOS / Linux
python run.py \
   --agent agents.sync_agent:AdvancedRetrievalAgent \
   --test_case_json test_cases/test_cases_all_en.json \
   --test_mode multi \
   --evaluator_type llm \
   --num_tests 1 \
   --save_results True
```

```powershell
# PowerShell (Windows)
python run.py `
   --agent agents.sync_agent:AdvancedRetrievalAgent `
   --test_case_json test_cases/test_cases_all_en.json `
   --test_mode multi `
   --evaluator_type llm `
   --num_tests 1 `
   --save_results True
```

4) æäº¤ï¼ˆç¡®è®¤ `results/` ä¸ `.env` ä¸­çš„å­¦ç”Ÿä¿¡æ¯æ­£ç¡®åï¼‰

```bash
python submit.py --agent agents.sync_agent:AdvancedRetrievalAgent
```

è¦ç‚¹æç¤ºï¼š

- ä½¿ç”¨å°è§„æ¨¡éªŒè¯ï¼ˆstep 2ï¼‰å¯ä»¥å¿«é€Ÿå®šä½é€»è¾‘/prompt é—®é¢˜ï¼Œé¿å…ä¸€æ¬¡è€—å°½é…é¢ã€‚
- è‹¥é€‰æ‹© `--evaluator_type llm`ï¼Œè¯„ä¼°æ­¥éª¤ä¼šé¢å¤–äº§ç”Ÿ API è°ƒç”¨ä¸å»¶è¿Ÿï¼Œè¯·é¢„ç•™é…é¢å¹¶é…Œæƒ…å‡å°‘ `num_tests`ã€‚
- ç¡®ä¿ `.env` ä¸­ `API_KEY`ã€`BASE_URL`ã€å­¦ç”Ÿä¿¡æ¯å­—æ®µå·²æ­£ç¡®å¡«å†™ï¼ˆ`check_api.py` å¯å¿«é€ŸéªŒè¯è¿é€šæ€§ï¼‰ã€‚

## ç»“æœä¸è¾“å‡º

- `results/*.json`ï¼šä¿å­˜æ¨¡å‹å›ç­”ã€å¾—åˆ†ã€è¿è¡Œæ—¶é—´ã€needle ä¿¡æ¯ç­‰ã€‚
- `contexts/*.txt`ï¼ˆå¯é€‰ï¼‰ï¼šä¿å­˜æ’å…¥ needle åçš„ä¸Šä¸‹æ–‡ï¼Œä¾¿äºå¤ç°ã€‚
- æ§åˆ¶å°æ—¥å¿—ï¼šæ±‡æ€»å„æµ‹è¯•ç”¨ä¾‹åŠå…¨å±€ç»Ÿè®¡ã€‚

## å¼€å‘å»ºè®®

- ä¼˜åŒ–æ£€ç´¢ç­–ç•¥ï¼šç»“åˆå…³é”®è¯å¬å›ã€å‘é‡æ£€ç´¢æˆ– RAGï¼Œå®šä½ needle æ‰€åœ¨æ®µè½ã€‚
- æ§åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦ï¼šåˆ©ç”¨ `encode_text_to_tokens` / `decode_tokens` ç²¾ç¡®æˆªæ–­ï¼Œç¡®ä¿è¯·æ±‚ä¸è¶…é™ã€‚
- è°ƒè¯•è¯„æµ‹å™¨ï¼š`string` æ¨¡å¼å¯å¿«é€ŸéªŒè¯é€»è¾‘ï¼Œ`llm` æ¨¡å¼èƒ½æä¾›æ›´ç»†ç²’åº¦è¯­ä¹‰è¯„åˆ†ã€‚

å¦‚éœ€æ›´å¤šèƒŒæ™¯ä¸è¯„åˆ†ç»†èŠ‚ï¼Œè¯·å‚é˜… `Assignment5.md`ã€‚ç¥ä½ å–å¾—å¥½æˆç»©ï¼
